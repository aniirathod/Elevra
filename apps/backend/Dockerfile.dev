# -----------------------------------------------------------------------------
# Development Dockerfile for @elevra/backend (NPM Version)
# -----------------------------------------------------------------------------
FROM node:20-alpine

# Install necessary system tools (openssl is required for Prisma)
RUN apk add --no-cache libc6-compat openssl

WORKDIR /app

# 1. Install global dependencies
RUN npm install -g turbo

# 2. Copy dependency definitions
#    Crucial: Copy package-lock.json instead of pnpm-lock.yaml
COPY package.json package-lock.json turbo.json ./
COPY apps/backend/package.json ./apps/backend/package.json

# 3. Install dependencies
RUN npm install

# 4. Generate Prisma Client (Initial generation)
COPY apps/backend/prisma ./apps/backend/prisma
RUN npx prisma generate --schema=apps/backend/prisma/schema.prisma

# 5. Expose the API port
EXPOSE 3000

# 6. Start command
#    Uses npx turbo to run the dev script defined in package.json
CMD ["npx", "turbo", "run", "dev", "--filter=@elevra/backend"]